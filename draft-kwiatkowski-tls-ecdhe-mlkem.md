---
title: Post-quantum hybrid ECDHE-MLKEM Key Agreement for TLSv1.3
abbrev: ECDHE-MLKEM
category: info

docname: draft-kwiatkowski-tls-ecdhe-mlkem-latest
submissiontype: IETF  # also: "independent", "IAB", or "IRTF"
number:
date:
stand_alone: yes
consensus: true
v: 3
ipr: trust200902
# area: AREA
workgroup: "Transport Layer Security"
keyword:
 - ECDH
 - hybrid
 - ML-KEM
 - post-quantum
 - x25519
venue:
  group: "Transport Layer Security"
  type: "Working Group"
  mail: "tls@ietf.org"
  github: post-quantum-cryptography/draft-kwiatkowski-tls-ecdhe-mlkem
  latest: https://post-quantum-cryptography.github.io/draft-kwiatkowski-tls-ecdhe-mlkem/

author:
  - ins: K. Kwiatkowski
    name: Kris Kwiatkowski
    organization: PQShield
    email: kris@amongbytes.com
  - ins: P. Kampanakis
    name: Panos Kampanakis
    organization: AWS
    email: kpanos@amazon.com
  - ins: B.E. Westerbaan
    name: Bas Westerbaan
    organization: Cloudflare
    email: bas@cloudflare.com
  - ins: D. Stebila
    name: Douglas Stebila
    organization: University of Waterloo
    email: dstebila@waterloo.ca

normative:
  rfc7748:
  FIPS203: DOI.10.6028/NIST.FIPS.203
  SP56A: DOI.10.6028/NIST.SP.800-56Ar3
  SP56C: DOI.10.6028/NIST.SP.800-56Cr2

informative:
  xyber: I-D.tls-westerbaan-xyber768d00-03
  hybrid: I-D.ietf-tls-hybrid-design
  tlsiana: I-D.ietf-tls-rfc8447bis
  HKDF: DOI.10.17487/RFC5869
  ECDSA:
       title: "Public Key Cryptography for the Financial Services Industry: The Elliptic Curve Digital Signature Algorithm (ECDSA)"
       author:
         org: American National Standards Institute
       date: 2005-11
       seriesinfo:
         ANSI: ANS X9.62-2005
--- abstract

This draft defines three hybrid key agreements for TLS 1.3: X25519MLKEM768,
SecP256r1MLKEM768, and SecP384r1MLKEM1024 which combine
a post-quantum KEM with an elliptic curve Diffie-Hellman (ECDHE).

--- middle

# Introduction

## Motivation
ML-KEM is a key encapsulation method (KEM) defined in the {{FIPS203}}. It is designed to
withstand cryptanalytic attacks from quantum computers.

This document introduces three new supported groups for hybrid post-quantum key
agreements in TLS 1.3: the X25519MLKEM768, SecP256r1MLKEM768,
and SecP384r1MLKEM1024 which combine ML-KEM with ECDH
in the manner of {{hybrid}}.

The first one uses X25519 {{rfc7748}} and is an update to X25519Kyber768Draft00 {{xyber}}, the
most widely deployed PQ/T hybrid combiner for TLS v1.3 deployed in 2024.

The second one uses secp256r1 (NIST P-256) {{ECDSA}} {{?DSS=DOI.10.6028/NIST.SP.800-186}}. The
goal of this group is to support a use case that requires both shared secrets to be generated by
FIPS-approved mechanisms.

The third one uses secp384r1 (NIST P-384) {{ECDSA}} {{?DSS=DOI.10.6028/NIST.SP.800-186}}.
The goal of this group is to provide support for high security environments
that require use of FIPS-approved mechanisms.

All constructions aim to provide a FIPS-approved key-establishment scheme (as per {{SP56C}}).

# Conventions and Definitions

{::boilerplate bcp14-tagged}

# Negotiated Groups

All groups enable the derivation of TLS session keys using FIPS-approved schemes. NIST's
special publication 800-56Cr2 {{SP56C}} approves the usage of HKDF
{{HKDF}} with two distinct shared secrets, with the condition that the first one is computed by
a FIPS-approved key-establishment scheme. FIPS also requires a certified implementation
of the scheme, which will remain more ubiqutous for secp256r1 in the coming years.

For this reason we put the ML-KEM shared secret first in X25519MLKEM768,
and the ECDH shared secret first in SecP256r1MLKEM768 and SecP384r1MLKEM1024.

Note: The group name X25519MLKEM768 does not adhere to the naming convention outlined in
{{Section 3.2 of hybrid}}. Specifically, the order of shares in the concatenation has been
reversed. This is due to historical reasons.

## Construction

### Client share

When the X25519MLKEM768 group is negotiated, the client's key_exchange value
is the concatenation of the client's ML-KEM-768 encapsulation key
and the client's X25519 ephemeral share.
The size of the client share is 1216 bytes (1184 bytes for the ML-KEM part and 32 bytes for X25519).

When the SecP256r1MLKEM768 group is negotiated, the client's key_exchange value
is the concatenation of the secp256r1 ephemeral share and ML-KEM-768 encapsulation key.
The ECDHE share is the serialized value of the uncompressed ECDH point representation as
defined  in {{Section 4.2.8.2 of !RFC8446}}. The size of the client share is 1249 bytes
(65 bytes for the secp256r1 part and 1184 bytes for ML-KEM).

When the SecP384r1MLKEM1024 group is negotiated, the client's key_exchange value
is the concatenation of the secp384r1 ephemeral share and the ML-KEM-1024
encapsulation key. The ECDH share is serialised value of the uncompressed ECDH point
represenation as defined in {{Section 4.2.8.2 of !RFC8446}}. The size of the
client share is 1665 bytes (97 bytes for the secp384r1 and the 1568 for the ML-KEM).

### Server share

When the X25519MLKEM768 group is negotiated, the server's key exchange
value is the concatenation of an ML-KEM ciphertext returned from encapsulation
to the client's encapsulation key, and the server's ephemeral X25519 share.
The size of the server share is 1120 bytes (1088 bytes for the ML-KEM part and 32 bytes for X25519).

When the SecP256r1MLKEM768 group is negotiated, the server's key exchange
value is the concatenation of the server's ephemeral secp256r1 share encoded
in the same way as the client share and an ML-KEM ciphertext returned from encapsulation
to the client's encapsulation key. The size of the server share is 1153 bytes (1088 bytes
for the ML-KEM part and 65 bytes for secp256r1).

When the SecP384r1MLKEM1024 group is negotiated, the server's key exchange
value is the concatenation of the server's ephemeral secp384r1 share
encoded in the same way as the client share and an ML-KEM ciphertext returned
from encapsulation to the client's encapsulation key. The size of the server
share is 1665 bytes (1568 bytes for the ML-KEM part and 97 bytes for
secp384r1)

For all groups, the server MUST perform the encapsulation key check
described in Section 7.2 of {{FIPS203}} on the client's encapsulation
key, and abort with an illegal_parameter alert if it fails.

For all groups, the client MUST check if the ciphertext length matches
the selected group, and abort with an illegal_parameter alert if it fails.
If ML-KEM decapsulation fails for any other reason, the connection MUST
be aborted with an internal_error alert.

For all groups, both client and server MUST process the ECDH part
as described in {{Section 4.2.8.2 of !RFC8446}}, including all validity checks,
and abort with an illegal_parameter alert if it fails.

### Shared secret

For X25519MLKEM768, the shared secret is the concatenation of the ML-KEM
shared secret and the X25519 shared secret. The shared secret is 64 bytes
(32 bytes for each part).

For SecP256r1MLKEM768, the shared secret is the concatenation of the
ECDHE and ML-KEM shared secret. The ECDHE shared secret is the x-coordinate of the ECDH
shared secret elliptic curve point represented as an octet string as
defined in {{Section 7.4.2 of !RFC8446}}.
The size of the shared secret is 64 bytes (32 bytes for each part).

For SecP384r1MLKEM1024, the shared secret is the concatenation of the
ECDHE and ML-KEM shared secret. The ECDHE shared secret is the x-coordinate of the ECDH
shared secret elliptic curve point represented as an octet string as
defined in {{Section 7.4.2 of !RFC8446}}.
The size of the shared secret is 80 bytes (48 bytes for the ECDH part and
32 bytes for the ML-KEM part).

For all groups, both client and server MUST calculate the ECDH part of the
shared secret as described in {{Section 7.4.2 of !RFC8446}}, including the
all-zero shared secret check for X25519, and abort the connection with an
illegal_parameter alert if it fails.

# Security Considerations

The same security considerations as those described in {{hybrid}} apply to the approach used by this document.
The security analysis relies crucially on the TLS 1.3 message transcript, and one cannot assume a similar
hybridisation is secure in other protocols.

Implementers are encouraged to use implementations resistant to side-channel attacks,
especially those that can be applied by remote attackers.

# IANA Considerations

This document requests/registers three new entries to the TLS Supported Groups registry, according
to the procedures in {{Section 6 of tlsiana}}. These identifiers are to be used with the final,
ratified by NIST, version of ML-KEM which is specified in {{FIPS203}}.

## SecP256r1MLKEM768

 Value:
 : 4587 (0x11EB)

 Description:
 : SecP256r1MLKEM768

 DTLS-OK:
 : Y

 Recommended:
 : N

 Reference:
 : This document

 Comment:
 : Combining secp256r1 ECDH with ML-KEM-768
 {: spacing="compact"}

## X25519MLKEM768

 Value:
 : 4588 (0x11EC)

 Description:
 : X25519MLKEM768

 DTLS-OK:
 : Y

 Recommended:
 : N

 Reference:
 : This document

 Comment:
 : Combining X25519 ECDH with ML-KEM-768
{: spacing="compact"}

## SecP384r1MLKEM1024

 Value:
 : 4589 (0x11ED)

 Description:
 : SecP384r1MLKEM1024

 DTLS-OK:
 : Y

 Recommended:
 : N

 Reference:
 : This document

 Comment:
 : Combining secp384r1 ECDH with ML-KEM-1024
{: spacing="compact"}

## Obsoleted Supported Groups

This document obsoletes 25497 and 25498 in the TLS Supported Groups registry.

--- back

# Change log

* draft-kwiatkowski-tls-ecdhe-mlkem-03:
  * Adds P-384 combined with ML-KEM-1024
  * Adds text that describes error-handling and outlines how the client and server must ensure the integrity of the key exchange process.
  * Adds note on the incompatibility of the codepoint name X25519MLKEM768 with {{hybrid}}.
  * Various cosmetic changes.

* draft-kwiatkowski-tls-ecdhe-mlkem-02:
  * Adds section that mentions supported groups that this document obsoletes.
  * Fix a reference to encapsulation in the FIPS 203.

* draft-kwiatkowski-tls-ecdhe-mlkem-01:
  * Add X25519MLKEM768

* draft-kwiatkowski-tls-ecdhe-mlkem-00:
  * Change Kyber name to ML-KEM
  * Swap reference to I-D.cfrg-schwabe-kyber with FIPS-203
  * Change codepoint. New value is equal to old value + 1.

* draft-kwiatkowski-tls-ecdhe-kyber-01: Fix size of key shares generated by the client and the server

* draft-kwiatkowski-tls-ecdhe-kyber-00: updates following IANA review
